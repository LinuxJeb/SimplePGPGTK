id: com.linuxjeb.simplepgp
runtime: org.gnome.Platform
runtime-version: "47"
sdk: org.gnome.Sdk
command: simple-pgp-gtk
build-options:
  strip: false
build-extensions:
  - org.freedesktop.Sdk.Extension.gcc
finish-args:
  - --share=network
  - --socket=fallback-x11
  - --socket=session-bus
  - --device=dri
  - --talk-name=org.freedesktop.secrets

environment:
  GNUPGHOME: /app/data/simplepgp/gpg

modules:
  - name: gnupg
    buildsystem: autotools
    config-opts:
      - --disable-doc
    sources:
      - type: archive
        url: https://gnupg.org/ftp/gcrypt/gnupg/gnupg-2.4.5.tar.bz2
        sha256: f68f7d75d06cb1635c336d34d844af97436c3f64ea14bcb7c869782f96f44277
  - name: create-gpg-dir
    buildsystem: simple
    build-commands:
      - mkdir -p /app/data/simplepgp/gpg
  - name: st
    buildsystem: simple
    build-commands:
      - cp config.def.h config.h
      - make CC="gcc -std=c99"
      - install -Dm755 st /app/bin/st
    sources:
      - type: archive
        url: https://dl.suckless.org/st/st-0.9.3.tar.gz
        sha256: 9ed9feabcded713d4ded38c8cebf36a3b08f0042ef7934a0e2b2409da56e649b
  - name: pinentry
    buildsystem: autotools
    config-opts:
      - --prefix=/app
    sources:
      - type: archive
        url: https://gnupg.org/ftp/gcrypt/pinentry/pinentry-1.3.2.tar.bz2
        sha256: 8e986ed88561b4da6e9efe0c54fa4ca8923035c99264df0b0464497c5fb94e9e
  - name: simple-pgp-gtk
    buildsystem: simple
    sources:
      - type: file
        path: simple-pgp-gtk
    build-commands:
      - install -Dm755 simple-pgp-gtk /app/bin/simple-pgp-gtk
